name: Sync from community to commercial
on:
  schedule:
    - cron: '*/15 * * * *'  # æ¯15åˆ†é’ŸåŒæ­¥ä¸€æ¬¡
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout commercial repo
        uses: actions/checkout@v4
        with:
          repository: ModelEngine-Group/nexent-commercial
          ref: develop  # æ˜ç¡®æŒ‡å®šåˆ†æ”¯
          ssh-key: ${{ secrets.SSH_PRIVATE_KEY }}  # å¿…é¡»é…ç½®SSH Key
          fetch-depth: 0  # è·å–å®Œæ•´å†å²

      - name: Add community repo as remote
        run: |
          git remote add repo-community git@github.com:ModelEngine-Group/nexent.git
          git fetch repo-community --tags

      - name: Merge community into commercial
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions-bot@github.com"
          # æ£€æŸ¥æ˜¯å¦æœ‰å®é™…å˜æ›´
          if ! git diff --quiet repo-community/develop develop; then
            git merge repo-community/main --allow-unrelated-histories -m "ğŸ”€ Sync from A-repo $(date +'%Y-%m-%d %H:%M')"
            git push origin develop
          else
            echo "â© No changes to sync."
          fi
