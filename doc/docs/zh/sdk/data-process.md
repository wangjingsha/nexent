# DataProcessCore ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

`DataProcessCore` æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ–‡ä»¶å¤„ç†æ ¸å¿ƒç±»ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼çš„è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†ï¼Œæä¾›çµæ´»çš„åˆ†å—ç­–ç•¥å’Œå¤šç§è¾“å…¥æºæ”¯æŒã€‚

## â­ ä¸»è¦åŠŸèƒ½

### 1. æ ¸å¿ƒå¤„ç†æ–¹æ³•ï¼š`file_process()`

**å‡½æ•°ç­¾åï¼š**
```python
def file_process(self, 
                file_path_or_url: Optional[str] = None, 
                file_data: Optional[bytes] = None, 
                chunking_strategy: str = "basic", 
                destination: str = "local", 
                filename: Optional[str] = None, 
                **params) -> List[Dict]
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | æè¿° | å¯é€‰å€¼ |
|--------|------|------|------|--------|
| `file_path_or_url` | `str` | å¦* | æœ¬åœ°æ–‡ä»¶è·¯å¾„æˆ–è¿œç¨‹URL | ä»»ä½•æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„æˆ–URL |
| `file_data` | `bytes` | å¦* | æ–‡ä»¶çš„å­—èŠ‚æ•°æ®ï¼ˆç”¨äºå†…å­˜å¤„ç†ï¼‰ | ä»»ä½•æœ‰æ•ˆçš„å­—èŠ‚æ•°æ® |
| `chunking_strategy` | `str` | å¦ | åˆ†å—ç­–ç•¥ | `"basic"`, `"by_title"`, `"none"` |
| `destination` | `str` | å¦ | ç›®æ ‡ç±»å‹ï¼ŒæŒ‡ç¤ºæ–‡ä»¶æ¥æº | `"local"`, `"minio"`, `"url"` |
| `filename` | `str` | å¦** | æ–‡ä»¶å | ä»»ä½•æœ‰æ•ˆçš„æ–‡ä»¶å |
| `**params` | `dict` | å¦ | é¢å¤–çš„å¤„ç†å‚æ•° | è§ä¸‹æ–¹å‚æ•°è¯¦æƒ… |

*æ³¨ï¼š`file_path_or_url` å’Œ `file_data` å¿…é¡»æä¾›å…¶ä¸­ä¸€ä¸ª
**æ³¨ï¼šä½¿ç”¨ `file_data` æ—¶ï¼Œ`filename` ä¸ºå¿…éœ€å‚æ•°

**åˆ†å—ç­–ç•¥ (`chunking_strategy`) è¯¦è§£ï¼š**

| ç­–ç•¥å€¼ | æè¿° | é€‚ç”¨åœºæ™¯ | è¾“å‡ºç‰¹ç‚¹ |
|--------|------|----------|----------|
| `"basic"` | åŸºç¡€åˆ†å—ç­–ç•¥ | å¤§å¤šæ•°æ–‡æ¡£å¤„ç†åœºæ™¯ | æ ¹æ®å†…å®¹é•¿åº¦è‡ªåŠ¨åˆ†å— |
| `"by_title"` | æŒ‰æ ‡é¢˜åˆ†å— | ç»“æ„åŒ–æ–‡æ¡£ï¼ˆå¦‚æŠ€æœ¯æ–‡æ¡£ã€æŠ¥å‘Šï¼‰ | ä»¥æ ‡é¢˜ä¸ºç•Œé™è¿›è¡Œåˆ†å— |
| `"none"` | ä¸åˆ†å— | çŸ­æ–‡æ¡£æˆ–éœ€è¦å®Œæ•´å†…å®¹çš„åœºæ™¯ | è¿”å›å•ä¸ªåŒ…å«å…¨éƒ¨å†…å®¹çš„å— |

**ç›®æ ‡ç±»å‹ (`destination`) è¯¦è§£ï¼š**

| ç›®æ ‡å€¼ | æè¿° | ä½¿ç”¨åœºæ™¯ | è¦æ±‚ |
|--------|------|----------|------|
| `"local"` | æœ¬åœ°æ–‡ä»¶ | å¤„ç†æœ¬åœ°å­˜å‚¨çš„æ–‡ä»¶ | æä¾›æœ‰æ•ˆçš„æœ¬åœ°æ–‡ä»¶è·¯å¾„ |
| `"minio"` | MinIOå­˜å‚¨ | å¤„ç†äº‘å­˜å‚¨ä¸­çš„æ–‡ä»¶ | éœ€è¦æ•°æ®åº“ä¾èµ– |
| `"url"` | è¿œç¨‹URL | å¤„ç†ç½‘ç»œèµ„æº | éœ€è¦æ•°æ®åº“ä¾èµ– |

**é¢å¤–å‚æ•° (`**params`) è¯¦è§£ï¼š**

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | æè¿° | é€‚ç”¨å¤„ç†å™¨ |
|--------|------|--------|------|-----------|
| `max_characters` | `int` | `1500` | æ¯ä¸ªå—çš„æœ€å¤§å­—ç¬¦æ•° | Generic |
| `new_after_n_chars` | `int` | `1200` | è¾¾åˆ°æ­¤å­—ç¬¦æ•°åå¼€å§‹æ–°å— | Generic |
| `strategy` | `str` | `"fast"` | å¤„ç†ç­–ç•¥ | Generic |
| `skip_infer_table_types` | `list` | `[]` | è·³è¿‡æ¨æ–­çš„è¡¨æ ¼ç±»å‹ | Generic |
| `task_id` | `str` | `""` | ä»»åŠ¡æ ‡è¯†ç¬¦ | Generic |

**è¿”å›å€¼æ ¼å¼ï¼š**

è¿”å› `List[Dict]`ï¼Œæ¯ä¸ªå­—å…¸åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

**é€šç”¨å­—æ®µï¼š**
| å­—æ®µå | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|------|
| `content` | `str` | æ–‡æœ¬å†…å®¹ | `"è¿™æ˜¯æ–‡æ¡£çš„ç¬¬ä¸€æ®µ..."` |
| `path_or_url` | `str` | æ–‡ä»¶è·¯å¾„æˆ–URL | `"/path/to/file.pdf"` |
| `filename` | `str` | æ–‡ä»¶å | `"document.pdf"` |

**Excelæ–‡ä»¶é¢å¤–å­—æ®µï¼š**
| å­—æ®µå | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|------|
| `metadata` | `dict` | å…ƒæ•°æ®ä¿¡æ¯ | `{"chunk_index": 0, "file_type": "xlsx"}` |

**Genericæ–‡ä»¶é¢å¤–å­—æ®µï¼š**
| å­—æ®µå | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|------|
| `language` | `str` | è¯­è¨€æ ‡è¯†ï¼ˆå¯é€‰ï¼‰ | `"en"` |
| `metadata` | `dict` | å…ƒæ•°æ®ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ | `{"chunk_index": 0}` |

## ğŸ“ æ”¯æŒçš„æ–‡ä»¶ç±»å‹

### Excelæ–‡ä»¶
- `.xlsx` - Excel 2007åŠæ›´é«˜ç‰ˆæœ¬
- `.xls` - Excel 97-2003ç‰ˆæœ¬

### é€šç”¨æ–‡ä»¶
- `.txt` - çº¯æ–‡æœ¬æ–‡ä»¶
- `.pdf` - PDFæ–‡æ¡£
- `.docx` - Word 2007åŠæ›´é«˜ç‰ˆæœ¬
- `.doc` - Word 97-2003ç‰ˆæœ¬
- `.html`, `.htm` - HTMLæ–‡æ¡£
- `.md` - Markdownæ–‡ä»¶
- `.rtf` - å¯Œæ–‡æœ¬æ ¼å¼
- `.odt` - OpenDocumentæ–‡æœ¬
- `.pptx` - PowerPoint 2007åŠæ›´é«˜ç‰ˆæœ¬
- `.ppt` - PowerPoint 97-2003ç‰ˆæœ¬

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¤„ç†æœ¬åœ°æ–‡æœ¬æ–‡ä»¶
```python
from nexent.data_process import DataProcessCore

core = DataProcessCore()

# åŸºç¡€å¤„ç†
result = core.file_process(
    file_path_or_url="/path/to/document.txt",
    destination="local",
    chunking_strategy="basic"
)

print(f"å¤„ç†å¾—åˆ° {len(result)} ä¸ªå—")
for i, chunk in enumerate(result):
    print(f"å— {i}: {chunk['content'][:100]}...")
```

### ç¤ºä¾‹2ï¼šå¤„ç†Excelæ–‡ä»¶
```python
# å¤„ç†Excelæ–‡ä»¶
result = core.file_process(
    file_path_or_url="/path/to/spreadsheet.xlsx",
    destination="local",
    chunking_strategy="none"  # Excelé€šå¸¸ä¸éœ€è¦åˆ†å—
)

for chunk in result:
    print(f"æ–‡ä»¶: {chunk['filename']}")
    print(f"å†…å®¹: {chunk['content']}")
    print(f"å…ƒæ•°æ®: {chunk['metadata']}")
```

### ç¤ºä¾‹3ï¼šå¤„ç†å†…å­˜ä¸­çš„æ–‡ä»¶
```python
# è¯»å–æ–‡ä»¶åˆ°å†…å­˜
with open("/path/to/document.pdf", "rb") as f:
    file_bytes = f.read()

# å¤„ç†å†…å­˜ä¸­çš„æ–‡ä»¶
result = core.file_process(
    file_data=file_bytes,
    filename="document.pdf",
    chunking_strategy="by_title",
    max_characters=2000  # è‡ªå®šä¹‰å‚æ•°
)
```

### ç¤ºä¾‹4ï¼šå¤„ç†è¿œç¨‹æ–‡ä»¶ï¼ˆéœ€è¦æ•°æ®åº“ä¾èµ–ï¼‰
```python
# å¤„ç†MinIOä¸­çš„æ–‡ä»¶
result = core.file_process(
    file_path_or_url="minio://bucket/path/to/file.docx",
    destination="minio",
    filename="file.docx",
    chunking_strategy="basic"
)
```

## ğŸ› ï¸ è¾…åŠ©æ–¹æ³•

### 1. è·å–æ”¯æŒçš„æ–‡ä»¶ç±»å‹
```python
core = DataProcessCore()
supported_types = core.get_supported_file_types()
print("Excelæ–‡ä»¶:", supported_types["excel"])
print("é€šç”¨æ–‡ä»¶:", supported_types["generic"])
```

### 2. éªŒè¯æ–‡ä»¶ç±»å‹
```python
is_supported = core.validate_file_type("document.pdf")
print(f"PDFæ–‡ä»¶æ˜¯å¦æ”¯æŒ: {is_supported}")
```

### 3. è·å–å¤„ç†å™¨ä¿¡æ¯
```python
info = core.get_processor_info("spreadsheet.xlsx")
print(f"å¤„ç†å™¨ç±»å‹: {info['processor_type']}")
print(f"æ–‡ä»¶æ‰©å±•å: {info['file_extension']}")
print(f"æ˜¯å¦æ”¯æŒ: {info['is_supported']}")
```

### 4. è·å–æ”¯æŒçš„ç­–ç•¥å’Œç›®æ ‡ç±»å‹
```python
strategies = core.get_supported_strategies()
destinations = core.get_supported_destinations()
print(f"æ”¯æŒçš„åˆ†å—ç­–ç•¥: {strategies}")
print(f"æ”¯æŒçš„ç›®æ ‡ç±»å‹: {destinations}")
```

## âš ï¸ é”™è¯¯å¤„ç†

### å¸¸è§å¼‚å¸¸

| å¼‚å¸¸ç±»å‹ | è§¦å‘æ¡ä»¶ | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| `ValueError` | å‚æ•°æ— æ•ˆï¼ˆå¦‚åŒæ—¶æä¾›file_path_or_urlå’Œfile_dataï¼‰ | æ£€æŸ¥å‚æ•°ç»„åˆ |
| `FileNotFoundError` | æœ¬åœ°æ–‡ä»¶ä¸å­˜åœ¨æˆ–è¿œç¨‹æ–‡ä»¶æ— æ³•è·å– | éªŒè¯æ–‡ä»¶è·¯å¾„ |
| `ImportError` | å¤„ç†è¿œç¨‹æ–‡ä»¶æ—¶ç¼ºå°‘æ•°æ®åº“ä¾èµ– | å®‰è£…ç›¸å…³ä¾èµ– |

### é”™è¯¯å¤„ç†ç¤ºä¾‹
```python
try:
    result = core.file_process(
        file_path_or_url="/nonexistent/file.txt",
        destination="local"
    )
except FileNotFoundError as e:
    print(f"æ–‡ä»¶æœªæ‰¾åˆ°: {e}")
except ValueError as e:
    print(f"å‚æ•°é”™è¯¯: {e}")
except Exception as e:
    print(f"å¤„ç†å¤±è´¥: {e}")
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **é€‰æ‹©åˆé€‚çš„åˆ†å—ç­–ç•¥**ï¼š
   - å°æ–‡ä»¶ä½¿ç”¨ `"none"`
   - å¤§æ–‡ä»¶ä½¿ç”¨ `"basic"`
   - ç»“æ„åŒ–æ–‡æ¡£ä½¿ç”¨ `"by_title"`

2. **è°ƒæ•´åˆ†å—å‚æ•°**ï¼š
   - æ ¹æ®ä¸‹æ¸¸å¤„ç†éœ€æ±‚è°ƒæ•´ `max_characters`
   - å¹³è¡¡å¤„ç†é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨

3. **æ–‡ä»¶ç±»å‹ä¼˜åŒ–**ï¼š
   - Excelæ–‡ä»¶é€šå¸¸ä¸éœ€è¦åˆ†å—
   - PDFæ–‡ä»¶å»ºè®®ä½¿ç”¨è¾ƒå¤§çš„ `max_characters`

4. **æ‰¹é‡å¤„ç†**ï¼š
   - å¤ç”¨ `DataProcessCore` å®ä¾‹
   - é¿å…é‡å¤åˆå§‹åŒ–

## ğŸ”„ æ•°æ®æµæ¶æ„

Nexent ç³»ç»Ÿä¸­çš„æ•°æ®å¤„ç†éµå¾ªä»¥ä¸‹æµç¨‹æ¨¡å¼ï¼š

### 1. ç”¨æˆ·è¯·æ±‚æµç¨‹
```
ç”¨æˆ·è¾“å…¥ â†’ å‰ç«¯éªŒè¯ â†’ APIè°ƒç”¨ â†’ åç«¯è·¯ç”± â†’ ä¸šåŠ¡æœåŠ¡ â†’ æ•°æ®è®¿é—® â†’ æ•°æ®åº“
```

### 2. AI Agentæ‰§è¡Œæµç¨‹
```
ç”¨æˆ·æ¶ˆæ¯ â†’ Agentåˆ›å»º â†’ å·¥å…·è°ƒç”¨ â†’ æ¨¡å‹æ¨ç† â†’ æµå¼å“åº” â†’ ç»“æœä¿å­˜
```

### 3. çŸ¥è¯†åº“æ–‡ä»¶å¤„ç†æµç¨‹
```
æ–‡ä»¶ä¸Šä¼  â†’ ä¸´æ—¶å­˜å‚¨ â†’ æ•°æ®å¤„ç† â†’ å‘é‡åŒ– â†’ çŸ¥è¯†åº“å­˜å‚¨ â†’ ç´¢å¼•æ›´æ–°
```

**è¯¦ç»†æ­¥éª¤**ï¼š
1. **æ–‡ä»¶ä¸Šä¼ **: å‰ç«¯æ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶
2. **ä¸´æ—¶å­˜å‚¨**: æ–‡ä»¶å­˜å‚¨åˆ°ä¸´æ—¶ä½ç½®æˆ–MinIO
3. **æ•°æ®å¤„ç†**: ä½¿ç”¨ `DataProcessCore` è¿›è¡Œæ ¼å¼è½¬æ¢å’Œåˆ†å—
4. **å‘é‡åŒ–**: é€šè¿‡åµŒå…¥æ¨¡å‹ç”Ÿæˆå‘é‡è¡¨ç¤º
5. **çŸ¥è¯†åº“å­˜å‚¨**: å°†å¤„ç†åçš„å†…å®¹å­˜å‚¨åˆ°Elasticsearch
6. **ç´¢å¼•æ›´æ–°**: æ›´æ–°æœç´¢ç´¢å¼•ä»¥æ”¯æŒæ£€ç´¢

### 4. å®æ—¶æ–‡ä»¶å¤„ç†æµç¨‹
```
æ–‡ä»¶ä¸Šä¼  â†’ ä¸´æ—¶å­˜å‚¨ â†’ æ•°æ®å¤„ç† â†’ Agentå¤„ç† â†’ å®æ—¶å›ç­”
```

**è¯¦ç»†æ­¥éª¤**ï¼š
1. **æ–‡ä»¶ä¸Šä¼ **: ç”¨æˆ·åœ¨å¯¹è¯ä¸­ä¸Šä¼ æ–‡ä»¶
2. **ä¸´æ—¶å­˜å‚¨**: æ–‡ä»¶ä¸´æ—¶ä¿å­˜ç”¨äºå¤„ç†
3. **æ•°æ®å¤„ç†**: å®æ—¶æå–æ–‡ä»¶å†…å®¹å’Œç»“æ„
4. **Agentå¤„ç†**: AIæ™ºèƒ½ä½“åˆ†ææ–‡ä»¶å†…å®¹
5. **å®æ—¶å›ç­”**: åŸºäºæ–‡ä»¶å†…å®¹æä¾›å³æ—¶å›å¤

### æ•°æ®å¤„ç†ä¼˜åŒ–ç­–ç•¥

- **å¼‚æ­¥å¤„ç†**: å¤§æ–‡ä»¶å¤„ç†ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
- **æ‰¹é‡æ“ä½œ**: å¤šæ–‡ä»¶å¤„ç†æ—¶ä½¿ç”¨æ‰¹é‡ä¼˜åŒ–
- **ç¼“å­˜æœºåˆ¶**: é‡å¤æ–‡ä»¶çš„å¤„ç†ç»“æœç¼“å­˜
- **æµå¼å¤„ç†**: å¤§æ–‡ä»¶çš„å†…å­˜æµå¼å¤„ç†